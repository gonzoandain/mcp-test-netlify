# Codebase Structure

**Analysis Date:** 2026-02-04

## Directory Layout

```
mcp-test-netlify/
├── netlify/functions/        # Netlify Functions (entry points)
├── src/                       # TypeScript source (compiled to dist/)
├── public/                    # Static files (HTML documentation)
├── dist/                      # Compiled JavaScript output
├── .netlify/                  # Netlify metadata and internal functions
├── .planning/                 # GSD planning documentation
├── package.json               # Project metadata and dependencies
├── tsconfig.json              # TypeScript compiler configuration
└── netlify.toml               # Netlify deployment configuration
```

## Directory Purposes

**`netlify/functions/`:**
- Purpose: Netlify Functions entry points (serverless handlers)
- Contains: TypeScript function files, automatically deployed by Netlify
- Key files: `mcp.ts` (MCP protocol handler), `test.ts` (placeholder)

**`src/`:**
- Purpose: TypeScript source code for shared logic
- Contains: MCP server configuration, HTTP client utilities, tool definitions
- Key files: `oneappServer.ts` (server factory with all tool definitions)

**`public/`:**
- Purpose: Static files served at site root
- Contains: HTML documentation and deployment instructions
- Key files: `index.html`

**`dist/`:**
- Purpose: Compiled JavaScript output directory
- Contains: Transpiled `.js` and `.d.ts` files (excluded from git)
- Generated: Yes (by `npm run build`)
- Committed: No (in .gitignore)

**`.netlify/`:**
- Purpose: Netlify internal configuration and local development builds
- Contains: Function metadata, local function server builds
- Generated: Yes (by Netlify CLI)
- Committed: No

**`.planning/codebase/`:**
- Purpose: GSD analysis documentation
- Contains: ARCHITECTURE.md, STRUCTURE.md, CONVENTIONS.md, etc.
- Generated: Yes (by GSD mapping)
- Committed: Yes

## Key File Locations

**Entry Points:**
- `netlify/functions/mcp.ts`: Main MCP HTTP handler, session management, protocol routing
- `src/oneappServer.ts`: MCP server factory, tool registration, HTTP client logic

**Configuration:**
- `netlify.toml`: Netlify deployment config (function output dir, publish dir, paths)
- `tsconfig.json`: TypeScript compiler settings (target ES2022, ESNext modules, strict mode)
- `package.json`: Dependencies, build/dev scripts

**Core Logic:**
- `src/oneappServer.ts`: API aggregation layer with 15+ MCP tools for OneApp APIs
- `netlify/functions/mcp.ts`: Session-aware HTTP transport for MCP protocol

**Documentation:**
- `public/index.html`: User-facing documentation and deployment instructions

## Naming Conventions

**Files:**
- TypeScript files: lowercase with hyphens for multi-word names (e.g., `oneappServer.ts`)
- Functions: kebab-case for file names, camelCase for exports
- No file extensions in imports (ES modules with TypeScript)

**Directories:**
- Lowercase: `src/`, `netlify/`, `public/`, `dist/`
- Kebab-case for multi-word: `netlify/functions/`

**Functions:**
- Factory functions: `buildOneAppServer()` (verb-noun pattern)
- Handler functions: `handler()` (explicit role naming)
- Utility functions: `httpJson()`, `getServer()` (verb pattern)

**Variables:**
- Environment variables: SCREAMING_SNAKE_CASE (`CORE_BASE_URL`, `HTTP_TIMEOUT_MS`)
- Constants: SCREAMING_SNAKE_CASE (`CORE_BASE`, `CLIENT_BASE`, `HTTP_TIMEOUT_MS`)
- Local variables: camelCase (`sessionId`, `transport`, `requestBody`)

**Types:**
- Generic type variables: `T` (used in `httpJson<T>()`)
- No explicit type files (.d.ts generated by TypeScript)

## Where to Add New Code

**New Tool:**
- Primary code: Add to `buildOneAppServer()` in `src/oneappServer.ts`
- Implementation pattern: `server.tool()` call with Zod schema and async handler
- HTTP calls: Use existing `httpJson()` helper function
- Testing: Requires MCP client to verify tool invocation

**New Function (Endpoint):**
- Implementation: Create new file in `netlify/functions/` (auto-deployed)
- Config path: Add route mapping to `netlify.toml` if needed
- Session needs: Use mcp.ts as template for session management

**Utility/Helper:**
- Shared logic: Add to `src/` directory in appropriately named file
- Export pattern: Named exports for reusability
- Import pattern: Relative imports with `.js` extension (ES modules)

**Configuration:**
- Environment variables: Document in tool handler with defaults
- API base URLs: Add to `oneappServer.ts` constants (lines 16-20)
- Timeouts: Add as new HTTP_TIMEOUT_MS pattern

## Special Directories

**`dist/`:**
- Purpose: TypeScript compilation output
- Generated: Yes (by `npm run build`, runs `tsc`)
- Committed: No
- Contains: `.js` files matching `src/` and `netlify/` structure

**`.netlify/`:**
- Purpose: Local Netlify CLI environment and function builds
- Generated: Yes (by `netlify dev`)
- Committed: No
- Contains: Development function server (`functions-serve/`), blob store

## Build System

**Compilation:**
- Tool: TypeScript (`tsc`)
- Input: `src/`, `netlify/` (via tsconfig.json include)
- Output: `dist/` directory
- Config: `tsconfig.json` with strict mode, ES2022 target, ES modules

**Development:**
- Command: `npm run dev` or `npm start` (runs `netlify dev`)
- Watches: Source files, recompiles on change
- Function output: Served from `dist/netlify/functions/`
- Static: Served from `public/`

**Deployment:**
- Platform: Netlify
- Functions source: `netlify/functions/` (raw TypeScript)
- Build step: Netlify compiles via `npm run build`
- Static publish: `public/`
- Function path mapping: Configured in `netlify.toml`

---

*Structure analysis: 2026-02-04*
