---
phase: 04-header-routing-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/routing.ts
  - src/cache.ts
  - src/validation.ts
autonomous: true

must_haves:
  truths:
    - "routing.ts no longer exists in src/"
    - "cache.ts no longer exists in src/"
    - "TypeScript compiles without errors"
    - "Error messages include list_clients hint"
  artifacts:
    - path: "src/validation.ts"
      provides: "clientId validation with list_clients hint in errors"
      contains: "list_clients"
  key_links: []
---

<objective>
Delete legacy routing infrastructure files (routing.ts, cache.ts) and update validation.ts with list_clients hint.

Purpose: Complete the cleanup of header-based routing that became obsolete in Phase 3 when tools started accepting clientId as parameter.
Output: Smaller codebase with no dead files, improved error messages with discovery hint.
</objective>

<execution_context>
@/Users/gonzo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gonzo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-header-routing-cleanup/04-CONTEXT.md
@.planning/phases/04-header-routing-cleanup/04-RESEARCH.md
@src/validation.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete legacy routing files</name>
  <files>src/routing.ts, src/cache.ts</files>
  <action>
Delete the following files that are no longer imported anywhere:
- src/routing.ts (144 lines - header validation logic)
- src/cache.ts (129 lines - per-client server caching)

These files were verified to have no imports via grep search. Phase 3 already removed all references when implementing clientId as tool parameter.

Use rm command or equivalent file deletion. Do NOT attempt to "archive" or "backup" - this is a clean removal.
  </action>
  <verify>
Run: `ls src/routing.ts src/cache.ts 2>&1` - should show "No such file or directory" for both
Run: `npx tsc --noEmit` - should compile without errors
  </verify>
  <done>routing.ts and cache.ts deleted, TypeScript still compiles</done>
</task>

<task type="auto">
  <name>Task 2: Update validation.ts error messages with list_clients hint</name>
  <files>src/validation.ts</files>
  <action>
Update src/validation.ts with two changes:

1. Update line 20 comment - remove routing.ts reference:
FROM: `// Normalize: trim and lowercase (matching routing.ts pattern)`
TO: `// Normalize: trim and lowercase for consistent lookup`

2. Add list_clients hint to both error messages per CONTEXT.md decision:
   "Error messages include hint: 'Use list_clients to see available clients'"

Update line 28 (invalid format error):
FROM:
```typescript
error: `Invalid client ID format: "${clientId}". Must contain only lowercase alphanumeric characters and underscores. Valid clients: ${validIds.join(', ')}`,
```
TO:
```typescript
error: `Invalid client ID format: "${clientId}". Must contain only lowercase alphanumeric characters and underscores. Use list_clients to see available clients.`,
```

Update line 38 (unknown client error):
FROM:
```typescript
error: `Unknown client ID: "${clientId}". Valid clients: ${validIds.join(', ')}`,
```
TO:
```typescript
error: `Unknown client ID: "${clientId}". Use list_clients to see available clients.`,
```

Note: The list_clients hint replaces the inline list of valid clients. This is cleaner because:
- Teaches the LLM about the discovery tool
- Works regardless of how many clients exist
- Error message stays concise
  </action>
  <verify>
Run: `grep -n "routing.ts" src/validation.ts` - should return no matches
Run: `grep -n "list_clients" src/validation.ts` - should show both error messages with hint
Run: `grep "Valid clients:" src/validation.ts` - should return no matches (removed)
  </verify>
  <done>validation.ts no longer references routing.ts, error messages include list_clients hint</done>
</task>

</tasks>

<verification>
1. `ls src/*.ts` shows: config.ts, httpClient.ts, oneappServer.ts, types.ts, validation.ts (5 files, NOT 7)
2. `npx tsc --noEmit` compiles successfully
3. `grep -r "routing.ts\|cache.ts" src/` returns no matches
4. `grep "list_clients" src/validation.ts` shows hint in error messages
</verification>

<success_criteria>
- routing.ts deleted from src/
- cache.ts deleted from src/
- validation.ts comment updated (no routing.ts reference)
- validation.ts error messages include "Use list_clients to see available clients"
- TypeScript builds without errors
- Requirements CLEN-03 and CLEN-04 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/04-header-routing-cleanup/04-01-SUMMARY.md`
</output>
